<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unicity Shopify Market Decision Tool v3</title>
    <link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #0d1b2a; --secondary: #1b263b; --accent: #00d4aa; --accent-hover: #00b894;
            --warning: #ffc107; --danger: #e74c3c; --success: #27ae60;
            --text: #e0e1dd; --text-muted: #778da9; --card-bg: rgba(27, 38, 59, 0.8);
            --border: rgba(0, 212, 170, 0.2); --shopify-green: #95bf47; --worldpay-blue: #00a0df; --shop2-purple: #8b5cf6;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Instrument Sans', sans-serif; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 50%, #0d1b2a 100%); min-height: 100vh; color: var(--text); line-height: 1.6; }
        .container { max-width: 1400px; margin: 0 auto; padding: 30px 20px; }
        header { text-align: center; margin-bottom: 40px; padding-bottom: 30px; border-bottom: 1px solid var(--border); }
        header h1 { font-size: 2.5rem; font-weight: 700; margin-bottom: 10px; background: linear-gradient(135deg, var(--accent) 0%, #00b894 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        header p { color: var(--text-muted); font-size: 1.1rem; }
        .version-badge { display: inline-block; background: var(--accent); color: var(--primary); padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; margin-top: 10px; }
        .search-section { background: var(--card-bg); border: 1px solid var(--border); border-radius: 16px; padding: 30px; margin-bottom: 30px; }
        .search-row { display: grid; grid-template-columns: 1fr 200px 200px; gap: 20px; align-items: end; }
        .form-group { display: flex; flex-direction: column; gap: 8px; }
        .form-group label { font-weight: 600; color: var(--text); font-size: 0.9rem; }
        .form-group select, .form-group input { background: var(--secondary); border: 1px solid var(--border); border-radius: 8px; padding: 12px 16px; color: var(--text); font-size: 1rem; font-family: inherit; }
        .form-group select:focus, .form-group input:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px rgba(0, 212, 170, 0.1); }
        .btn { background: var(--accent); color: var(--primary); border: none; padding: 12px 24px; border-radius: 8px; font-weight: 600; font-size: 1rem; cursor: pointer; transition: all 0.2s; }
        .btn:hover { background: var(--accent-hover); transform: translateY(-1px); }
        .results-section { display: none; }
        .results-section.visible { display: block; }
        .country-header { display: flex; align-items: center; gap: 20px; margin-bottom: 30px; }
        .country-flag { font-size: 4rem; }
        .country-info h2 { font-size: 2rem; margin-bottom: 5px; }
        .country-info .currency { color: var(--accent); font-family: 'Space Mono', monospace; font-size: 1.1rem; }
        .status-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .status-card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 12px; padding: 20px; text-align: center; }
        .status-card .status-icon { font-size: 2rem; margin-bottom: 10px; }
        .status-card .status-label { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 5px; }
        .status-card .status-value { font-weight: 700; font-size: 1rem; }
        .status-card .status-value.yes { color: var(--success); }
        .status-card .status-value.no { color: var(--danger); }
        .status-card .status-value.partial { color: var(--warning); }
        .recommendation-panel { background: linear-gradient(135deg, rgba(0, 212, 170, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%); border: 2px solid var(--accent); border-radius: 16px; padding: 30px; margin-bottom: 30px; }
        .recommendation-panel h3 { font-size: 1.4rem; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
        .recommendation-badge { display: inline-block; padding: 6px 14px; border-radius: 20px; font-size: 0.8rem; font-weight: 700; text-transform: uppercase; }
        .badge-shopify { background: var(--shopify-green); color: #000; }
        .badge-worldpay { background: var(--worldpay-blue); color: #fff; }
        .badge-shop2 { background: var(--shop2-purple); color: #fff; }
        .timeline-info { display: flex; gap: 30px; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border); flex-wrap: wrap; }
        .timeline-item { flex: 1; min-width: 150px; }
        .timeline-item h5 { color: var(--text-muted); font-size: 0.8rem; margin-bottom: 5px; text-transform: uppercase; }
        .timeline-item .time { font-size: 1.5rem; font-weight: 700; color: var(--accent); }
        .models-section { margin-bottom: 30px; }
        .models-section h3 { font-size: 1.3rem; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid var(--border); }
        .model-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .model-card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 16px; padding: 25px; transition: transform 0.2s, border-color 0.2s; }
        .model-card:hover { transform: translateY(-3px); }
        .model-card.recommended { border-color: var(--accent); box-shadow: 0 0 30px rgba(0, 212, 170, 0.2); }
        .model-card.unavailable { opacity: 0.5; }
        .model-card .model-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; }
        .model-card h4 { font-size: 1.1rem; margin-bottom: 5px; }
        .model-card .model-type { font-size: 0.8rem; color: var(--text-muted); }
        .model-available { padding: 4px 10px; border-radius: 15px; font-size: 0.7rem; font-weight: 600; }
        .model-available.yes { background: rgba(39, 174, 96, 0.2); color: var(--success); }
        .model-available.no { background: rgba(231, 76, 60, 0.2); color: var(--danger); }
        .model-features { list-style: none; margin: 15px 0; }
        .model-features li { display: flex; align-items: center; gap: 10px; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 0.9rem; }
        .model-features li:last-child { border-bottom: none; }
        .feature-icon { width: 20px; text-align: center; }
        .model-rate { background: var(--secondary); border-radius: 10px; padding: 15px; margin-top: 15px; }
        .model-rate .rate-label { font-size: 0.8rem; color: var(--text-muted); margin-bottom: 5px; }
        .model-rate .rate-value { font-size: 1.8rem; font-weight: 700; font-family: 'Space Mono', monospace; color: var(--accent); }
        .model-rate .rate-breakdown { font-size: 0.75rem; color: var(--text-muted); margin-top: 5px; }
        .fee-table-section { margin-bottom: 30px; }
        .fee-table-section h3 { font-size: 1.3rem; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid var(--border); }
        .fee-table-wrapper { background: var(--card-bg); border: 1px solid var(--border); border-radius: 16px; overflow-x: auto; }
        .fee-table { width: 100%; border-collapse: collapse; min-width: 600px; }
        .fee-table th, .fee-table td { padding: 15px 20px; text-align: left; border-bottom: 1px solid var(--border); }
        .fee-table th { background: var(--secondary); font-weight: 600; font-size: 0.85rem; text-transform: uppercase; color: var(--text-muted); }
        .fee-table tr:last-child td { border-bottom: none; }
        .fee-table .highlight-row { background: rgba(0, 212, 170, 0.1); }
        .fee-table .total-cell { font-weight: 700; font-family: 'Space Mono', monospace; color: var(--accent); }
        .gateways-section { margin-bottom: 30px; }
        .gateways-section h3 { font-size: 1.3rem; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid var(--border); }
        .gateway-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; }
        .gateway-card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 12px; padding: 20px; }
        .gateway-card.primary { border-color: var(--accent); background: rgba(0, 212, 170, 0.05); }
        .gateway-card h5 { font-size: 1rem; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }
        .gateway-card .gateway-type { font-size: 0.7rem; padding: 3px 8px; background: var(--secondary); border-radius: 10px; color: var(--text-muted); }
        .gateway-card .gateway-rate { font-family: 'Space Mono', monospace; font-size: 1.2rem; color: var(--accent); margin: 10px 0; }
        .gateway-card .gateway-features { font-size: 0.8rem; color: var(--text-muted); }
        .notes-section { background: rgba(255, 193, 7, 0.1); border: 1px solid var(--warning); border-radius: 12px; padding: 20px; margin-bottom: 30px; }
        .notes-section h4 { color: var(--warning); margin-bottom: 10px; }
        .notes-section ul { list-style: none; }
        .notes-section li { padding: 5px 0; padding-left: 20px; position: relative; font-size: 0.9rem; }
        .notes-section li::before { content: "â€¢"; position: absolute; left: 0; color: var(--warning); }
        .markets-section { background: var(--card-bg); border: 1px solid var(--border); border-radius: 16px; padding: 25px; margin-bottom: 30px; }
        .markets-section h3 { font-size: 1.2rem; margin-bottom: 15px; }
        .markets-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 15px; }
        .market-tags { display: flex; flex-wrap: wrap; gap: 8px; }
        .market-tag { background: var(--secondary); border: 1px solid var(--border); padding: 8px 14px; border-radius: 20px; font-size: 0.85rem; cursor: pointer; transition: all 0.2s; }
        .market-tag:hover { border-color: var(--accent); background: rgba(0, 212, 170, 0.1); }
        .dropdown-wrapper { position: relative; }
        .dropdown-btn { background: var(--secondary); border: 1px solid var(--border); padding: 10px 16px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 0.9rem; color: var(--text); }
        .dropdown-btn:hover { border-color: var(--accent); }
        .dropdown-content { display: none; position: absolute; top: 100%; right: 0; margin-top: 5px; background: var(--secondary); border: 1px solid var(--border); border-radius: 8px; min-width: 250px; max-height: 300px; overflow-y: auto; z-index: 100; }
        .dropdown-content.show { display: block; }
        .dropdown-item { padding: 10px 16px; cursor: pointer; display: flex; justify-content: space-between; border-bottom: 1px solid var(--border); font-size: 0.9rem; }
        .dropdown-item:last-child { border-bottom: none; }
        .dropdown-item:hover { background: rgba(0, 212, 170, 0.1); }
        footer { text-align: center; padding: 30px; border-top: 1px solid var(--border); color: var(--text-muted); font-size: 0.85rem; }
        .autocomplete-wrapper { position: relative; }
        .autocomplete-list { position: absolute; top: 100%; left: 0; right: 0; background: var(--secondary); border: 1px solid var(--border); border-radius: 8px; max-height: 300px; overflow-y: auto; z-index: 100; display: none; }
        .autocomplete-list.visible { display: block; }
        .autocomplete-item { padding: 12px 16px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); }
        .autocomplete-item:last-child { border-bottom: none; }
        .autocomplete-item:hover { background: rgba(0, 212, 170, 0.1); }
        .autocomplete-item .country-name { font-weight: 500; }
        .autocomplete-item .currency-code { font-family: 'Space Mono', monospace; font-size: 0.85rem; color: var(--accent); }
        .payment-methods-section { margin-bottom: 30px; }
        .payment-methods-section h3 { font-size: 1.3rem; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid var(--border); }
        .payment-methods-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 12px; }
        .payment-method { background: var(--card-bg); border: 1px solid var(--border); border-radius: 10px; padding: 15px; text-align: center; }
        .payment-method.available { border-color: var(--success); background: rgba(39, 174, 96, 0.1); }
        .payment-method.unavailable { opacity: 0.4; }
        .payment-method .pm-icon { font-size: 1.8rem; margin-bottom: 8px; }
        .payment-method .pm-name { font-size: 0.85rem; font-weight: 600; }
        .payment-method .pm-status { font-size: 0.7rem; color: var(--text-muted); margin-top: 4px; }
        @media (max-width: 768px) { .search-row { grid-template-columns: 1fr; } .store-toggle { flex-direction: column; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ›’ Unicity Shopify Market Decision Tool</h1>
            <p>Evaluate payment processing options for any global market</p>
            <span class="version-badge">v3.0 | January 2026</span>
        </header>
        <div class="markets-section">
            <div class="markets-header">
                <h3>ğŸ›ï¸ Shop Pay Available Markets</h3>
                <div class="dropdown-wrapper">
                    <div class="dropdown-btn" onclick="toggleDropdown()">â­ Unicity Active Markets <span>â–¼</span></div>
                    <div class="dropdown-content" id="unicityDropdown"></div>
                </div>
            </div>
            <div class="market-tags" id="shopPayMarkets"></div>
        </div>
        <div class="search-section">
            <div class="search-row">
                <div class="form-group autocomplete-wrapper">
                    <label for="countrySearch">Search Country or Currency</label>
                    <input type="text" id="countrySearch" placeholder="Type country name or currency code...">
                    <div class="autocomplete-list" id="autocompleteList"></div>
                </div>
                <div class="form-group">
                    <label for="orderValue">Order Value</label>
                    <div style="display:flex;gap:8px;align-items:center;">
                        <input type="number" id="orderValue" value="150" min="1" style="flex:1;">
                        <select id="currencyMode" onchange="updateCurrencyDisplay()" style="width:90px;background:var(--secondary);border:1px solid var(--border);border-radius:8px;padding:8px;color:var(--text);font-size:0.9rem;">
                            <option value="USD">USD</option>
                            <option value="local">Local</option>
                        </select>
                    </div>
                    <div id="currencyConversion" style="font-size:0.8rem;color:var(--text-muted);margin-top:4px;display:none;"></div>
                </div>
                <div class="form-group">
                    <label>&nbsp;</label>
                    <button class="btn" onclick="analyzeMarket()">Analyze Market</button>
                </div>
            </div>
        </div>
        <div class="results-section" id="resultsSection"></div>
        <footer>
            <p>Built for Unicity Payment Operations | Worldpay MCP: 0.15% proc + 1.7% FX + ~1% IC = ~2.85% (+0.20% if Shopify Payments market) | v3.0 January 2026</p>
        </footer>
    </div>
<script>
const MARKET_DATA = {
    "US": { name: "United States", currency: "USD", flag: "ğŸ‡ºğŸ‡¸", region: "North America", shopifyPayments: true, shopPay: true, subscriptionsWork: true, domesticRate: 2.15, crossBorderRate: 3.3, fxFee: 1.5, setupTime: "1-2 days", worldpayMCP: true, worldpayRate: 2.85, paymentMethods: { shopPay: true, applePay: true, googlePay: true, paypal: true, klarna: true, affirm: true, afterpay: true }, localGateways: ["Authorize.net", "Stripe", "Affirm"], notes: ["Primary US entity", "Full domestic rates"], unicityActive: true },
    "CA": { name: "Canada", currency: "CAD", flag: "ğŸ‡¨ğŸ‡¦", region: "North America", shopifyPayments: true, shopPay: true, subscriptionsWork: true, domesticRate: 2.4, crossBorderRate: 3.3, fxFee: 2.0, setupTime: "1-2 days", worldpayMCP: true, worldpayRate: 2.85, paymentMethods: { shopPay: true, applePay: true, googlePay: true, paypal: true, interac: true }, localGateways: ["Moneris", "Interac"], notes: ["Shopify HQ"], unicityActive: true },
    "MX": { name: "Mexico", currency: "MXN", flag: "ğŸ‡²ğŸ‡½", region: "North America", shopifyPayments: true, shopPay: true, subscriptionsWork: true, domesticRate: 3.6, crossBorderRate: 4.2, fxFee: 2.0, setupTime: "3-5 days", worldpayMCP: true, worldpayRate: 3.2, paymentMethods: { shopPay: true, applePay: true, googlePay: true, paypal: true, oxxo: true, spei: true, dimo: true }, localGateways: ["Conekta", "OXXO"], notes: ["OXXO cash essential", "DiMo 7M+ users"], unicityActive: false, topMobilePayments: ["DiMo", "Spin by OXXO"] },
    "GB": { name: "United Kingdom", currency: "GBP", flag: "ğŸ‡¬ğŸ‡§", region: "Europe", shopifyPayments: true, shopPay: true, subscriptionsWork: true, domesticRate: 1.6, crossBorderRate: 2.8, fxFee: 2.0, setupTime: "1-2 days", worldpayMCP: true, worldpayRate: 2.85, paymentMethods: { shopPay: true, applePay: true, googlePay: true, paypal: true, klarna: true, clearpay: true }, localGateways: ["Klarna", "Clearpay"], notes: ["Excellent rates"], unicityActive: true },
    "DE": { name: "Germany", currency: "EUR", flag: "ğŸ‡©ğŸ‡ª", region: "Europe", shopifyPayments: true, shopPay: true, subscriptionsWork: true, domesticRate: 1.9, crossBorderRate: 2.9, fxFee: 2.0, setupTime: "1-2 days", worldpayMCP: true, worldpayRate: 2.85, paymentMethods: { shopPay: true, applePay: true, googlePay: true, paypal: true, klarna: true, giropay: true, sofort: true }, localGateways: ["Klarna", "SEPA", "Giropay"], notes: ["Klarna very popular"], unicityActive: true },
    "FR": { name: "France", currency: "EUR", flag: "ğŸ‡«ğŸ‡·", region: "Europe", shopifyPayments: true, shopPay: true, subscriptionsWork: true, domesticRate: 1.9, crossBorderRate: 2.9, fxFee: 2.0, setupTime: "1-2 days", worldpayMCP: true, worldpayRate: 2.85, paymentMethods: { shopPay: true, applePay: true, googlePay: true, paypal: true, klarna: true, alma: true }, localGateways: ["Alma", "Mollie"], notes: ["Alma BNPL growing"], unicityActive: true },
    "IT": { name: "Italy", currency: "EUR", flag: "ğŸ‡®ğŸ‡¹", region: "Europe", shopifyPayments: true, shopPay: true, subscriptionsWork: true, domesticRate: 1.9, crossBorderRate: 2.9, fxFee: 2.0, setupTime: "1-2 days", worldpayMCP: true, worldpayRate: 2.85, paymentMethods: { shopPay: true, applePay: true, googlePay: true, paypal: true, klarna: true, satispay: true }, localGateways: ["Nexi", "Satispay"], notes: ["Satispay growing"], unicityActive: true },
    "ES": { name: "Spain", currency: "EUR", flag: "ğŸ‡ªğŸ‡¸", region: "Europe", shopifyPayments: true, shopPay: true, subscriptionsWork: true, domesticRate: 1.9, crossBorderRate: 2.9, fxFee: 2.0, setupTime: "1-2 days", worldpayMCP: true, worldpayRate: 2.85, paymentMethods: { shopPay: true, applePay: true, googlePay: true, paypal: true, klarna: true, bizum: true }, localGateways: ["Bizum", "SeQura"], notes: ["Bizum P2P popular"], unicityActive: false },
    "NL": { name: "Netherlands", currency: "EUR", flag: "ğŸ‡³ğŸ‡±", region: "Europe", shopifyPayments: true, shopPay: true, subscriptionsWork: true, domesticRate: 1.9, crossBorderRate: 2.9, fxFee: 2.0, setupTime: "1-2 days", worldpayMCP: true, worldpayRate: 2.85, paymentMethods: { shopPay: true, applePay: true, googlePay: true, paypal: true, klarna: true, ideal: true }, localGateways: ["iDEAL", "Mollie"], notes: ["iDEAL dominates 60%+"], unicityActive: true },
    "BE": { name: "Belgium", currency: "EUR", flag: "ğŸ‡§ğŸ‡ª", region: "Europe", shopifyPayments: true, shopPay: true, subscriptionsWork: true, domesticRate: 1.9, crossBorderRate: 2.9, fxFee: 2.0, setupTime: "1-2 days", worldpayMCP: true, worldpayRate: 2.85, paymentMethods: { shopPay: true, applePay: true, googlePay: true, paypal: true, bancontact: true }, localGateways: ["Bancontact"], notes: ["Bancontact dominant"], unicityActive: false },
    "AT": { name: "Austria", currency: "EUR", flag: "ğŸ‡¦ğŸ‡¹", region: "Europe", shopifyPayments: true, shopPay: true, subscriptionsWork: true, domesticRate: 1.9, crossBorderRate: 2.9, fxFee: 2.0, setupTime: "1-2 days", worldpayMCP: true, worldpayRate: 2.85, paymentMethods: { shopPay: true, applePay: true, googlePay: true, paypal: true, klarna: true, eps: true }, localGateways: ["EPS", "Sofort"], notes: ["EPS bank transfers"], unicityActive: false },
    "CH": { name: "Switzerland", currency: "CHF", flag: "ğŸ‡¨ğŸ‡­", region: "Europe", shopifyPayments: true, shopPay: true, subscriptionsWork: true, domesticRate: 2.3, crossBorderRate: 3.2, fxFee: 2.0, setupTime: "1-2 days", worldpayMCP: true, worldpayRate: 2.85, paymentMethods: { shopPay: true, applePay: true, googlePay: true, paypal: true, twint: true }, localGateways: ["TWINT", "PostFinance"], notes: ["TWINT dominant"], unicityActive: true },
    "IE": { name: "Ireland", currency: "EUR", flag: "ğŸ‡®ğŸ‡ª", region: "Europe", shopifyPayments: true, shopPay: true, subscriptionsWork: true, domesticRate: 1.9, crossBorderRate: 2.9, fxFee: 2.0, setupTime: "1-2 days", worldpayMCP: true, worldpayRate: 2.85, paymentMethods: { shopPay: true, applePay: true, googlePay: true, paypal: true, klarna: true }, localGateways: ["Stripe"], notes: ["Stripe HQ"], unicityActive: false },
    "PT": { name: "Portugal", currency: "EUR", flag: "ğŸ‡µğŸ‡¹", region: "Europe", shopifyPayments: true, shopPay: true, subscriptionsWork: true, domesticRate: 1.9, crossBorderRate: 2.9, fxFee: 2.0, setupTime: "1-2 days", worldpayMCP: true, worldpayRate: 2.85, paymentMethods: { shopPay: true, applePay: true, googlePay: true, paypal: true, mbway: true }, localGateways: ["MB WAY", "Multibanco"], notes: ["MB WAY popular"], unicityActive: false },
    "DK": { name: "Denmark", currency: "DKK", flag: "ğŸ‡©ğŸ‡°", region: "Europe", shopifyPayments: true, shopPay: true, subscriptionsWork: true, domesticRate: 1.9, crossBorderRate: 2.9, fxFee: 2.0, setupTime: "1-2 days", worldpayMCP: true, worldpayRate: 2.85, paymentMethods: { shopPay: true, applePay: true, googlePay: true, paypal: true, klarna: true, mobilepay: true }, localGateways: ["MobilePay"], notes: ["MobilePay dominant"], unicityActive: true },
    "SE": { name: "Sweden", currency: "SEK", flag: "ğŸ‡¸ğŸ‡ª", region: "Europe", shopifyPayments: true, shopPay: true, subscriptionsWork: true, domesticRate: 1.9, crossBorderRate: 2.9, fxFee: 2.0, setupTime: "1-2 days", worldpayMCP: true, worldpayRate: 2.85, paymentMethods: { shopPay: true, applePay: true, googlePay: true, paypal: true, klarna: true, swish: true }, localGateways: ["Swish", "Klarna"], notes: ["Swish dominant", "Klarna home"], unicityActive: true },
    "NO": { name: "Norway", currency: "NOK", flag: "ğŸ‡³ğŸ‡´", region: "Europe", shopifyPayments: true, shopPay: true, subscriptionsWork: true, domesticRate: 2.1, crossBorderRate: 3.0, fxFee: 2.0, setupTime: "1-2 days", worldpayMCP: true, worldpayRate: 2.85, paymentMethods: { shopPay: true, applePay: true, googlePay: true, paypal: true, klarna: true, vipps: true }, localGateways: ["Vipps"], notes: ["Vipps dominant"], unicityActive: false },
    "FI": { name: "Finland", currency: "EUR", flag: "ğŸ‡«ğŸ‡®", region: "Europe", shopifyPayments: true, shopPay: true, subscriptionsWork: true, domesticRate: 1.9, crossBorderRate: 2.9, fxFee: 2.0, setupTime: "1-2 days", worldpayMCP: true, worldpayRate: 2.85, paymentMethods: { shopPay: true, applePay: true, googlePay: true, paypal: true, klarna: true }, localGateways: ["MobilePay"], notes: ["Strong digital"], unicityActive: false },
    "PL": { name: "Poland", currency: "PLN", flag: "ğŸ‡µğŸ‡±", region: "Europe", shopifyPayments: true, shopPay: true, subscriptionsWork: true, domesticRate: 2.2, crossBorderRate: 3.1, fxFee: 2.0, setupTime: "2-3 days", worldpayMCP: true, worldpayRate: 2.85, paymentMethods: { shopPay: true, applePay: true, googlePay: true, paypal: true, blik: true, p24: true }, localGateways: ["Przelewy24", "BLIK"], notes: ["BLIK essential"], unicityActive: false },
    "CZ": { name: "Czech Republic", currency: "CZK", flag: "ğŸ‡¨ğŸ‡¿", region: "Europe", shopifyPayments: true, shopPay: true, subscriptionsWork: true, domesticRate: 2.2, crossBorderRate: 3.1, fxFee: 2.0, setupTime: "2-3 days", worldpayMCP: true, worldpayRate: 2.85, paymentMethods: { shopPay: true, applePay: true, googlePay: true, paypal: true }, localGateways: ["Comgate"], unicityActive: false },
    "RO": { name: "Romania", currency: "RON", flag: "ğŸ‡·ğŸ‡´", region: "Europe", shopifyPayments: true, shopPay: true, subscriptionsWork: true, domesticRate: 2.5, crossBorderRate: 3.3, fxFee: 2.0, setupTime: "2-3 days", worldpayMCP: true, worldpayRate: 2.85, paymentMethods: { shopPay: true, applePay: true, googlePay: true, paypal: true }, localGateways: ["PayU Romania"], unicityActive: false },
    "HU": { name: "Hungary", currency: "HUF", flag: "ğŸ‡­ğŸ‡º", region: "Europe", shopifyPayments: true, shopPay: true, subscriptionsWork: true, domesticRate: 2.5, crossBorderRate: 3.3, fxFee: 2.0, setupTime: "2-3 days", worldpayMCP: true, worldpayRate: 2.85, paymentMethods: { shopPay: true, applePay: true, googlePay: true, paypal: true }, localGateways: ["SimplePay"], unicityActive: false },
    "HR": { name: "Croatia", currency: "EUR", flag: "ğŸ‡­ğŸ‡·", region: "Europe", shopifyPayments: true, shopPay: true, subscriptionsWork: true, domesticRate: 2.2, crossBorderRate: 3.1, fxFee: 2.0, setupTime: "2-3 days", worldpayMCP: true, worldpayRate: 2.85, paymentMethods: { shopPay: true, applePay: true, googlePay: true, paypal: true }, localGateways: ["CorvusPay"], unicityActive: false },
    "GR": { name: "Greece", currency: "EUR", flag: "ğŸ‡¬ğŸ‡·", region: "Europe", shopifyPayments: true, shopPay: true, subscriptionsWork: true, domesticRate: 2.3, crossBorderRate: 3.1, fxFee: 2.0, setupTime: "2-3 days", worldpayMCP: true, worldpayRate: 2.85, paymentMethods: { shopPay: true, applePay: true, googlePay: true, paypal: true }, localGateways: ["Viva Wallet"], unicityActive: false },
    "AU": { name: "Australia", currency: "AUD", flag: "ğŸ‡¦ğŸ‡º", region: "Asia Pacific", shopifyPayments: true, shopPay: true, subscriptionsWork: true, domesticRate: 1.75, crossBorderRate: 2.9, fxFee: 2.0, setupTime: "1-2 days", worldpayMCP: true, worldpayRate: 2.85, paymentMethods: { shopPay: true, applePay: true, googlePay: true, paypal: true, klarna: true, afterpay: true, zip: true }, localGateways: ["Afterpay", "Zip"], notes: ["Afterpay dominant"], unicityActive: true },
    "NZ": { name: "New Zealand", currency: "NZD", flag: "ğŸ‡³ğŸ‡¿", region: "Asia Pacific", shopifyPayments: true, shopPay: true, subscriptionsWork: true, domesticRate: 2.5, crossBorderRate: 3.3, fxFee: 2.0, setupTime: "1-2 days", worldpayMCP: true, worldpayRate: 2.85, paymentMethods: { shopPay: true, applePay: true, googlePay: true, paypal: true, afterpay: true, laybuy: true }, localGateways: ["Afterpay", "Laybuy"], notes: ["No Managed Markets restriction", "Key Unicity store"], unicityActive: true },
    "JP": { name: "Japan", currency: "JPY", flag: "ğŸ‡¯ğŸ‡µ", region: "Asia Pacific", shopifyPayments: true, shopPay: true, subscriptionsWork: true, domesticRate: 3.4, crossBorderRate: 3.9, fxFee: 2.0, setupTime: "3-5 days", worldpayMCP: true, worldpayRate: 3.5, paymentMethods: { shopPay: true, applePay: true, googlePay: true, paypal: true, konbini: true, paidy: true, paypay: true }, localGateways: ["KOMOJU", "Paidy", "Konbini"], notes: ["Konbini essential", "PayPay dominant"], unicityActive: true, topMobilePayments: ["PayPay", "LINE Pay"] },
    "SG": { name: "Singapore", currency: "SGD", flag: "ğŸ‡¸ğŸ‡¬", region: "Asia Pacific", shopifyPayments: true, shopPay: true, subscriptionsWork: true, domesticRate: 3.2, crossBorderRate: 3.8, fxFee: 2.0, setupTime: "2-3 days", worldpayMCP: true, worldpayRate: 2.85, paymentMethods: { shopPay: true, applePay: true, googlePay: true, paypal: true, grabpay: true, paynow: true }, localGateways: ["GrabPay", "PayNow"], notes: ["GrabPay popular"], unicityActive: true, topMobilePayments: ["PayNow", "GrabPay"] },
    "HK": { name: "Hong Kong", currency: "HKD", flag: "ğŸ‡­ğŸ‡°", region: "Asia Pacific", shopifyPayments: true, shopPay: true, subscriptionsWork: true, domesticRate: 3.2, crossBorderRate: 3.8, fxFee: 2.0, setupTime: "2-3 days", worldpayMCP: true, worldpayRate: 2.85, paymentMethods: { shopPay: true, applePay: true, googlePay: true, paypal: true, alipayhk: true, wechatpayhk: true }, localGateways: ["Alipay HK", "WeChat Pay HK"], notes: ["Alipay/WeChat for tourists"], unicityActive: true },
    "AE": { name: "United Arab Emirates", currency: "AED", flag: "ğŸ‡¦ğŸ‡ª", region: "Middle East", shopifyPayments: false, shopPay: false, subscriptionsWork: true, thirdPartyFee: 0.20, setupTime: "2-3 days", worldpayMCP: true, worldpayRate: 2.85, paymentMethods: { shopPay: false, applePay: true, googlePay: true, paypal: true, tabby: true, tamara: true }, localGateways: ["Tap Payments", "Checkout.com", "Tabby"], notes: ["One-Leg-Out favorable", "Tabby BNPL growing"], unicityActive: true, topMobilePayments: ["Apple Pay", "Tabby"] },
    "SA": { name: "Saudi Arabia", currency: "SAR", flag: "ğŸ‡¸ğŸ‡¦", region: "Middle East", shopifyPayments: false, shopPay: false, subscriptionsWork: true, thirdPartyFee: 0.20, setupTime: "2-3 days", worldpayMCP: true, worldpayRate: 2.85, paymentMethods: { shopPay: false, applePay: true, googlePay: true, paypal: true, tabby: true, tamara: true, mada: true }, localGateways: ["Tap Payments", "Checkout.com"], notes: ["MADA debit dominant"], unicityActive: false },
    "KW": { name: "Kuwait", currency: "KWD", flag: "ğŸ‡°ğŸ‡¼", region: "Middle East", shopifyPayments: false, shopPay: false, subscriptionsWork: true, thirdPartyFee: 0.20, setupTime: "2-3 days", worldpayMCP: true, worldpayRate: 2.85, paymentMethods: { shopPay: false, applePay: true, googlePay: true, paypal: true, knet: true }, localGateways: ["Tap Payments", "MyFatoorah"], notes: ["KNET local debit"], unicityActive: false },
    "TH": { name: "Thailand", currency: "THB", flag: "ğŸ‡¹ğŸ‡­", region: "Southeast Asia", shopifyPayments: false, shopPay: false, subscriptionsWork: true, thirdPartyFee: 0.20, setupTime: "2-3 days", worldpayMCP: true, worldpayRate: 2.85, localRate: 3.5, paymentMethods: { shopPay: false, applePay: true, googlePay: true, paypal: true, promptpay: true, truemoney: true, linepay: true }, localGateways: ["2C2P", "PromptPay"], notes: ["PromptPay QR dominant"], unicityActive: true, topMobilePayments: ["PromptPay", "TrueMoney"] },
    "MY": { name: "Malaysia", currency: "MYR", flag: "ğŸ‡²ğŸ‡¾", region: "Southeast Asia", shopifyPayments: false, shopPay: false, subscriptionsWork: true, thirdPartyFee: 0.20, setupTime: "2-3 days", worldpayMCP: true, worldpayRate: 2.85, localRate: 3.5, paymentMethods: { shopPay: false, applePay: true, googlePay: true, paypal: true, fpx: true, grabpay: true, touchngo: true }, localGateways: ["2C2P", "FPX", "GrabPay"], notes: ["FPX dominant"], unicityActive: true, topMobilePayments: ["Touch 'n Go", "GrabPay"] },
    "ID": { name: "Indonesia", currency: "IDR", flag: "ğŸ‡®ğŸ‡©", region: "Southeast Asia", shopifyPayments: false, shopPay: false, subscriptionsWork: true, thirdPartyFee: 0.20, setupTime: "2-3 days", worldpayMCP: true, worldpayRate: 3.2, localRate: 3.8, paymentMethods: { shopPay: false, applePay: false, googlePay: true, paypal: true, gopay: true, ovo: true, dana: true }, localGateways: ["2C2P", "Xendit", "GoPay", "OVO"], notes: ["E-wallets dominant"], unicityActive: true, topMobilePayments: ["GoPay", "OVO"] },
    "PH": { name: "Philippines", currency: "PHP", flag: "ğŸ‡µğŸ‡­", region: "Southeast Asia", shopifyPayments: false, shopPay: false, subscriptionsWork: true, thirdPartyFee: 0.20, setupTime: "2-3 days", worldpayMCP: true, worldpayRate: 2.85, localRate: 3.5, paymentMethods: { shopPay: false, applePay: true, googlePay: true, paypal: true, gcash: true, maya: true }, localGateways: ["2C2P", "GCash", "Maya"], notes: ["GCash dominant"], unicityActive: true, topMobilePayments: ["GCash", "Maya"] },
    "VN": { name: "Vietnam", currency: "VND", flag: "ğŸ‡»ğŸ‡³", region: "Southeast Asia", shopifyPayments: false, shopPay: false, subscriptionsWork: true, thirdPartyFee: 0.20, setupTime: "2-3 days", worldpayMCP: true, worldpayRate: 2.85, localRate: 3.5, paymentMethods: { shopPay: false, applePay: false, googlePay: true, paypal: true, momo: true, zalopay: true }, localGateways: ["2C2P", "MoMo", "ZaloPay"], notes: ["MoMo/ZaloPay dominant"], unicityActive: true, topMobilePayments: ["MoMo", "ZaloPay"] },
    "IN": { name: "India", currency: "INR", flag: "ğŸ‡®ğŸ‡³", region: "South Asia", shopifyPayments: false, shopPay: false, subscriptionsWork: true, thirdPartyFee: 0.20, setupTime: "5-7 days", worldpayMCP: false, localRate: 2.5, paymentMethods: { shopPay: false, applePay: false, googlePay: true, paypal: true, upi: true, paytm: true }, localGateways: ["Razorpay", "PayU", "Juspay"], notes: ["UPI dominant", "Juspay for orchestration"], unicityActive: false, topMobilePayments: ["UPI (PhonePe/GPay)", "Paytm"] },
    "KR": { name: "South Korea", currency: "KRW", flag: "ğŸ‡°ğŸ‡·", region: "East Asia", shopifyPayments: false, shopPay: false, subscriptionsWork: true, thirdPartyFee: 0.20, setupTime: "5-7 days", worldpayMCP: true, worldpayRate: 3.5, localRate: 3.5, paymentMethods: { shopPay: false, applePay: true, googlePay: true, paypal: true, kakaopay: true, naverpay: true }, localGateways: ["KG Inicis", "Toss", "KakaoPay"], notes: ["KakaoPay popular"], unicityActive: true, topMobilePayments: ["KakaoPay", "Naver Pay"] },
    "TW": { name: "Taiwan", currency: "TWD", flag: "ğŸ‡¹ğŸ‡¼", region: "East Asia", shopifyPayments: false, shopPay: false, subscriptionsWork: true, thirdPartyFee: 0.20, setupTime: "5-7 days", worldpayMCP: true, worldpayRate: 3.2, localRate: 3.2, paymentMethods: { shopPay: false, applePay: true, googlePay: true, paypal: true, linepay: true }, localGateways: ["TapPay", "ECPay", "LINE Pay"], notes: ["LINE Pay popular"], unicityActive: true },
    "CN": { name: "China", currency: "CNY", flag: "ğŸ‡¨ğŸ‡³", region: "East Asia", shopifyPayments: false, shopPay: false, subscriptionsWork: false, thirdPartyFee: 0.20, setupTime: "30+ days", worldpayMCP: false, localRate: 3.5, paymentMethods: { shopPay: false, applePay: false, googlePay: false, paypal: false, alipay: true, wechatpay: true }, localGateways: ["Alipay", "WeChat Pay"], notes: ["Complex regulations", "ICP license needed"], unicityActive: true, topMobilePayments: ["WeChat Pay", "Alipay"] },
    "CR": { name: "Costa Rica", currency: "CRC", flag: "ğŸ‡¨ğŸ‡·", region: "Latin America", shopifyPayments: false, shopPay: false, subscriptionsWork: true, thirdPartyFee: 0.20, setupTime: "2-3 days", worldpayMCP: true, worldpayRate: 2.85, paymentMethods: { shopPay: false, applePay: true, googlePay: true, paypal: true, sinpemovil: true }, localGateways: ["Tilopay"], notes: ["WP MCP best solution", "SINPE MÃ³vil dominant"], unicityActive: false, topMobilePayments: ["SINPE MÃ³vil", "Tilopay"] },
    "BR": { name: "Brazil", currency: "BRL", flag: "ğŸ‡§ğŸ‡·", region: "Latin America", shopifyPayments: false, shopPay: false, subscriptionsWork: true, thirdPartyFee: 0.20, setupTime: "5-7 days", worldpayMCP: true, worldpayRate: 4.2, localRate: 4.0, paymentMethods: { shopPay: false, applePay: true, googlePay: true, paypal: true, pix: true, boleto: true }, localGateways: ["Mercado Pago", "Pix"], notes: ["Pix revolutionary", "70%+ of transactions"], unicityActive: false, topMobilePayments: ["Pix", "PicPay"] },
    "PE": { name: "Peru", currency: "PEN", flag: "ğŸ‡µğŸ‡ª", region: "Latin America", shopifyPayments: false, shopPay: false, subscriptionsWork: true, thirdPartyFee: 0.20, setupTime: "3-5 days", worldpayMCP: true, paymentMethods: { shopPay: false, applePay: true, googlePay: true, paypal: true, yape: true, plin: true }, localGateways: ["Culqi", "PagoEfectivo"], notes: ["Yape dominates 54% of in-person transactions", "PLIN 34% share"], unicityActive: false, topMobilePayments: ["Yape", "PLIN"] },
    "CL": { name: "Chile", currency: "CLP", flag: "ğŸ‡¨ğŸ‡±", region: "Latin America", shopifyPayments: false, shopPay: false, subscriptionsWork: true, thirdPartyFee: 0.20, setupTime: "3-5 days", worldpayMCP: true, paymentMethods: { shopPay: false, applePay: true, googlePay: true, paypal: true, webpay: true, mach: true, tenpo: true }, localGateways: ["Transbank", "Webpay"], notes: ["MACH and Tenpo wallets popular", "Webpay dominant for cards"], unicityActive: false, topMobilePayments: ["MACH", "Tenpo"] },
    "CO": { name: "Colombia", currency: "COP", flag: "ğŸ‡¨ğŸ‡´", region: "Latin America", shopifyPayments: false, shopPay: false, subscriptionsWork: true, thirdPartyFee: 0.20, setupTime: "3-5 days", worldpayMCP: true, paymentMethods: { shopPay: false, applePay: true, googlePay: true, paypal: true, pse: true, nequi: true, daviplata: true }, localGateways: ["PayU", "PSE"], notes: ["Nequi 13M+ users", "Daviplata 19M customers"], unicityActive: false, topMobilePayments: ["Nequi", "Daviplata"] },
    "ZA": { name: "South Africa", currency: "ZAR", flag: "ğŸ‡¿ğŸ‡¦", region: "Africa", shopifyPayments: false, shopPay: false, subscriptionsWork: true, thirdPartyFee: 0.20, setupTime: "5-7 days", worldpayMCP: true, worldpayRate: 3.5, localRate: 3.5, paymentMethods: { shopPay: false, applePay: true, googlePay: true, paypal: true, snapscan: true }, localGateways: ["Paystack", "SnapScan"], notes: ["Paystack Africa leader"], unicityActive: false }
};

const WORLDPAY_MCP = { processingRate: 0.15, fxRate: 1.7, interchangeRate: 1.0, totalRate: 2.85 };
const SHOPIFY_PLUS = { domesticUS: 2.15, crossBorder: 3.3, fxFee: 1.5, thirdPartyFee: 0.20 };

const EXCHANGE_RATES = {
    USD: 1.00, CAD: 0.70, MXN: 0.058, GBP: 1.27, EUR: 1.08, CHF: 1.12,
    DKK: 0.145, SEK: 0.095, NOK: 0.091, PLN: 0.25, CZK: 0.043, HUF: 0.0027,
    RON: 0.22, AUD: 0.64, NZD: 0.58, JPY: 0.0067, SGD: 0.74, HKD: 0.128,
    AED: 0.272, SAR: 0.267, KWD: 3.25, THB: 0.029, MYR: 0.22, IDR: 0.000063,
    PHP: 0.018, VND: 0.00004, INR: 0.012, KRW: 0.00071, TWD: 0.031, CNY: 0.14,
    CRC: 0.002, BRL: 0.17, ZAR: 0.054, PEN: 0.27, CLP: 0.001, COP: 0.00024
};

let currentStore = 'us';

function convertToUSD(amount, currency) {
    var rate = EXCHANGE_RATES[currency] || 1;
    return amount * rate;
}

function convertFromUSD(amount, currency) {
    var rate = EXCHANGE_RATES[currency] || 1;
    return amount / rate;
}

function updateCurrencyDisplay() {
    var input = document.getElementById('countrySearch');
    var code = input.dataset.selectedCode;
    var conversionDiv = document.getElementById('currencyConversion');
    var currencyMode = document.getElementById('currencyMode').value;
    
    if (!code || !MARKET_DATA[code]) {
        conversionDiv.style.display = 'none';
        return;
    }
    
    var market = MARKET_DATA[code];
    var orderValue = parseFloat(document.getElementById('orderValue').value) || 150;
    
    if (currencyMode === 'local' && market.currency !== 'USD') {
        var usdValue = convertToUSD(orderValue, market.currency);
        conversionDiv.textContent = orderValue.toLocaleString() + ' ' + market.currency + ' â‰ˆ $' + usdValue.toFixed(2) + ' USD';
        conversionDiv.style.display = 'block';
    } else if (currencyMode === 'USD' && market.currency !== 'USD') {
        var localValue = convertFromUSD(orderValue, market.currency);
        conversionDiv.textContent = '$' + orderValue + ' USD â‰ˆ ' + localValue.toLocaleString(undefined, {maximumFractionDigits: 0}) + ' ' + market.currency;
        conversionDiv.style.display = 'block';
    } else {
        conversionDiv.style.display = 'none';
    }
}

function getOrderValueUSD() {
    var input = document.getElementById('countrySearch');
    var code = input.dataset.selectedCode;
    var currencyMode = document.getElementById('currencyMode').value;
    var orderValue = parseFloat(document.getElementById('orderValue').value) || 150;
    
    if (currencyMode === 'local' && code && MARKET_DATA[code]) {
        return convertToUSD(orderValue, MARKET_DATA[code].currency);
    }
    return orderValue;
}

const PM_CONFIG = {
    shopPay: { name: "Shop Pay", icon: "ğŸ›ï¸" }, applePay: { name: "Apple Pay", icon: "ğŸ" }, googlePay: { name: "Google Pay", icon: "ğŸ“±" },
    paypal: { name: "PayPal", icon: "ğŸ…¿ï¸" }, klarna: { name: "Klarna", icon: "ğŸ’³" }, afterpay: { name: "Afterpay", icon: "ğŸ’°" },
    affirm: { name: "Affirm", icon: "âœ“" }, ideal: { name: "iDEAL", icon: "ğŸ¦" }, bancontact: { name: "Bancontact", icon: "ğŸ‡§ğŸ‡ª" },
    giropay: { name: "Giropay", icon: "ğŸ‡©ğŸ‡ª" }, sofort: { name: "Sofort", icon: "âš¡" }, blik: { name: "BLIK", icon: "ğŸ‡µğŸ‡±" },
    swish: { name: "Swish", icon: "ğŸ‡¸ğŸ‡ª" }, vipps: { name: "Vipps", icon: "ğŸ‡³ğŸ‡´" }, mobilepay: { name: "MobilePay", icon: "ğŸ“²" },
    twint: { name: "TWINT", icon: "ğŸ‡¨ğŸ‡­" }, mbway: { name: "MB WAY", icon: "ğŸ‡µğŸ‡¹" }, bizum: { name: "Bizum", icon: "ğŸ‡ªğŸ‡¸" },
    interac: { name: "Interac", icon: "ğŸ‡¨ğŸ‡¦" }, oxxo: { name: "OXXO", icon: "ğŸª" }, konbini: { name: "Konbini", icon: "ğŸª" },
    paidy: { name: "Paidy", icon: "ğŸ‡¯ğŸ‡µ" }, paypay: { name: "PayPay", icon: "ğŸ’´" }, grabpay: { name: "GrabPay", icon: "ğŸš—" },
    paynow: { name: "PayNow", icon: "ğŸ‡¸ğŸ‡¬" }, fpx: { name: "FPX", icon: "ğŸ‡²ğŸ‡¾" }, touchngo: { name: "Touch 'n Go", icon: "ğŸ‘†" },
    promptpay: { name: "PromptPay", icon: "ğŸ‡¹ğŸ‡­" }, truemoney: { name: "TrueMoney", icon: "ğŸ’µ" }, linepay: { name: "LINE Pay", icon: "ğŸ’š" },
    momo: { name: "MoMo", icon: "ğŸ‡»ğŸ‡³" }, zalopay: { name: "ZaloPay", icon: "ğŸ’™" }, gcash: { name: "GCash", icon: "ğŸ‡µğŸ‡­" },
    maya: { name: "Maya", icon: "ğŸ’œ" }, gopay: { name: "GoPay", icon: "ğŸ‡®ğŸ‡©" }, ovo: { name: "OVO", icon: "ğŸ’œ" },
    dana: { name: "DANA", icon: "ğŸ”µ" }, upi: { name: "UPI", icon: "ğŸ‡®ğŸ‡³" }, paytm: { name: "Paytm", icon: "ğŸ“²" },
    pix: { name: "Pix", icon: "ğŸ‡§ğŸ‡·" }, boleto: { name: "Boleto", icon: "ğŸ“„" }, alipay: { name: "Alipay", icon: "ğŸ…°ï¸" },
    wechatpay: { name: "WeChat Pay", icon: "ğŸ’¬" }, alipayhk: { name: "Alipay HK", icon: "ğŸ…°ï¸" }, wechatpayhk: { name: "WeChat Pay HK", icon: "ğŸ’¬" },
    kakaopay: { name: "KakaoPay", icon: "ğŸ‡°ğŸ‡·" }, naverpay: { name: "Naver Pay", icon: "ğŸ’š" }, tabby: { name: "Tabby", icon: "ğŸ±" },
    tamara: { name: "Tamara", icon: "ğŸŒ™" }, mada: { name: "MADA", icon: "ğŸ’³" }, knet: { name: "KNET", icon: "ğŸ‡°ğŸ‡¼" },
    clearpay: { name: "Clearpay", icon: "ğŸ’³" }, zip: { name: "Zip", icon: "ğŸ¤" }, laybuy: { name: "Laybuy", icon: "ğŸ’°" },
    alma: { name: "Alma", icon: "ğŸ’³" }, satispay: { name: "Satispay", icon: "ğŸ’š" }, eps: { name: "EPS", icon: "ğŸ¦" },
    p24: { name: "Przelewy24", icon: "ğŸ‡µğŸ‡±" }, snapscan: { name: "SnapScan", icon: "ğŸ“±" },
    webpay: { name: "Webpay", icon: "ğŸ‡¨ğŸ‡±" }, pse: { name: "PSE", icon: "ğŸ‡¨ğŸ‡´" },
    sinpemovil: { name: "SINPE MÃ³vil", icon: "ğŸ‡¨ğŸ‡·" }, yape: { name: "Yape", icon: "ğŸ‡µğŸ‡ª" }, plin: { name: "PLIN", icon: "ğŸ‡µğŸ‡ª" },
    nequi: { name: "Nequi", icon: "ğŸ‡¨ğŸ‡´" }, daviplata: { name: "Daviplata", icon: "ğŸ‡¨ğŸ‡´" },
    mach: { name: "MACH", icon: "ğŸ‡¨ğŸ‡±" }, tenpo: { name: "Tenpo", icon: "ğŸ‡¨ğŸ‡±" },
    spei: { name: "SPEI", icon: "ğŸ‡²ğŸ‡½" }, dimo: { name: "DiMo", icon: "ğŸ‡²ğŸ‡½" }, picpay: { name: "PicPay", icon: "ğŸ‡§ğŸ‡·" }
};

function formatCurrency(amount) {
    return '$' + amount.toFixed(2);
}

function formatPercent(value) {
    return value.toFixed(2) + '%';
}

function toggleDropdown() {
    document.getElementById('unicityDropdown').classList.toggle('show');
}

document.addEventListener('click', function(e) {
    if (!e.target.closest('.dropdown-wrapper')) {
        document.getElementById('unicityDropdown').classList.remove('show');
    }
    if (!e.target.closest('.autocomplete-wrapper')) {
        document.getElementById('autocompleteList').classList.remove('visible');
    }
});

function initAutocomplete() {
    var input = document.getElementById('countrySearch');
    var list = document.getElementById('autocompleteList');
    input.addEventListener('input', function() {
        var value = this.value.toLowerCase();
        if (value.length < 1) { list.classList.remove('visible'); return; }
        var matches = Object.entries(MARKET_DATA).filter(function(entry) {
            var code = entry[0], data = entry[1];
            return data.name.toLowerCase().includes(value) || data.currency.toLowerCase().includes(value) || code.toLowerCase().includes(value);
        }).slice(0, 10);
        if (matches.length === 0) { list.classList.remove('visible'); return; }
        list.innerHTML = matches.map(function(entry) {
            var code = entry[0], data = entry[1];
            return '<div class="autocomplete-item" onclick="selectCountry(\'' + code + '\')"><span class="country-name">' + data.flag + ' ' + data.name + '</span><span class="currency-code">' + data.currency + '</span></div>';
        }).join('');
        list.classList.add('visible');
    });
}

function selectCountry(code) {
    var data = MARKET_DATA[code];
    var input = document.getElementById('countrySearch');
    input.value = data.flag + ' ' + data.name + ' (' + data.currency + ')';
    input.dataset.selectedCode = code;
    document.getElementById('autocompleteList').classList.remove('visible');
    document.getElementById('unicityDropdown').classList.remove('show');
    analyzeMarket();
}

function analyzeMarket() {
    var input = document.getElementById('countrySearch');
    var code = input.dataset.selectedCode;
    if (!code || !MARKET_DATA[code]) { alert('Please select a valid country'); return; }
    var market = MARKET_DATA[code];
    var orderValueUSD = getOrderValueUSD();
    var analysis = analyzeOptions(code, market, orderValueUSD);
    var resultsSection = document.getElementById('resultsSection');
    resultsSection.innerHTML = generateResultsHTML(code, market, orderValueUSD, analysis);
    resultsSection.classList.add('visible');
    resultsSection.scrollIntoView({ behavior: 'smooth' });
    updateCurrencyDisplay();
}

function analyzeOptions(code, market, orderValue) {
    var analysis = { recommended: null, models: [] };
    
    if (market.shopifyPayments) {
        var isDomestic = (currentStore === 'us' && code === 'US') || (currentStore === 'nz' && code === 'NZ') || (currentStore === 'local');
        var rate = isDomestic ? market.domesticRate : market.crossBorderRate;
        var fxFee = isDomestic ? 0 : market.fxFee;
        var totalRate = rate + fxFee;
        var fees = (orderValue * totalRate / 100) + 0.30;
        analysis.models.push({
            name: 'Shopify Payments', type: isDomestic ? 'Domestic' : 'Cross-Border', available: true,
            features: { shopPay: true, subscriptions: market.subscriptionsWork, applePay: true, localMethods: true },
            rate: totalRate, rateBreakdown: isDomestic ? market.domesticRate + '% + $0.30' : market.crossBorderRate + '% + ' + market.fxFee + '% FX',
            fees: fees, setupTime: market.setupTime || '1-2 days', shopifyFee: 0
        });
    } else {
        analysis.models.push({
            name: 'Shopify Payments', type: 'Not Available', available: false,
            features: { shopPay: false, subscriptions: false, applePay: false, localMethods: false },
            rate: null, rateBreakdown: 'Not available', fees: null, setupTime: 'N/A'
        });
    }

    var wpBaseRate = market.worldpayRate || WORLDPAY_MCP.totalRate;
    var wpShopifyFee = market.shopifyPayments ? SHOPIFY_PLUS.thirdPartyFee : 0;
    var wpEffectiveRate = wpBaseRate + wpShopifyFee;
    var wpFees = (orderValue * wpBaseRate / 100);
    var wpRateBreakdown = market.shopifyPayments 
        ? wpBaseRate + '% + ' + wpShopifyFee + '% Shopify fee' 
        : '0.15% + 1.7% FX + ~1% IC';
    
    analysis.models.push({
        name: 'Worldpay MCP', type: 'Third-Party Gateway', available: market.worldpayMCP !== false,
        features: { shopPay: false, subscriptions: true, applePay: true, localMethods: false },
        rate: wpEffectiveRate, rateBreakdown: wpRateBreakdown,
        fees: wpFees, setupTime: '2-3 days', shopifyFee: wpShopifyFee
    });

    var shop2Rate = market.worldpayRate || WORLDPAY_MCP.totalRate;
    var shop2Fees = (orderValue * shop2Rate / 100);
    analysis.models.push({
        name: 'Shop2 + Worldpay MCP', type: 'Alternative Platform', available: true,
        features: { shopPay: false, subscriptions: true, applePay: true, localMethods: false },
        rate: shop2Rate, rateBreakdown: '0.15% + 1.7% FX + ~1% IC',
        fees: shop2Fees, setupTime: '4-6 weeks', shopifyFee: 0
    });

    if (market.shopifyPayments && market.subscriptionsWork) {
        analysis.recommended = 'shopify';
        analysis.recommendedModel = analysis.models[0];
    } else if (market.worldpayMCP !== false) {
        analysis.recommended = 'worldpay';
        analysis.recommendedModel = analysis.models.find(function(m) { return m.name === 'Worldpay MCP'; });
    } else {
        analysis.recommended = 'shop2';
        analysis.recommendedModel = analysis.models.find(function(m) { return m.name.includes('Shop2'); });
    }
    return analysis;
}

function generatePaymentMethodsHTML(market) {
    if (!market.paymentMethods) return '';
    var html = '<div class="payment-methods-section"><h3>ğŸ’³ Available Payment Methods</h3><div class="payment-methods-grid">';
    var coreOrder = ['shopPay', 'applePay', 'googlePay', 'paypal'];
    coreOrder.forEach(function(method) {
        if (market.paymentMethods.hasOwnProperty(method)) {
            var config = PM_CONFIG[method] || { name: method, icon: 'ğŸ’³' };
            var available = market.paymentMethods[method];
            html += '<div class="payment-method ' + (available ? 'available' : 'unavailable') + '"><div class="pm-icon">' + config.icon + '</div><div class="pm-name">' + config.name + '</div><div class="pm-status">' + (available ? 'âœ“ Available' : 'âœ— N/A') + '</div></div>';
        }
    });
    Object.entries(market.paymentMethods).forEach(function(entry) {
        var method = entry[0], available = entry[1];
        if (!coreOrder.includes(method) && available) {
            var config = PM_CONFIG[method] || { name: method, icon: 'ğŸ’³' };
            html += '<div class="payment-method available"><div class="pm-icon">' + config.icon + '</div><div class="pm-name">' + config.name + '</div><div class="pm-status">âœ“ Available</div></div>';
        }
    });
    html += '</div></div>';
    return html;
}

function getRecommendationText(market, analysis) {
    if (market.shopifyPayments && market.subscriptionsWork) {
        return '<strong>Use Shopify Payments</strong> for ' + market.name + '. Full feature availability including Shop Pay express checkout, native subscriptions, and competitive transaction fees.';
    } else if (market.shopifyPayments && !market.subscriptionsWork) {
        return '<strong>Hybrid Model:</strong> Shopify for one-time purchases (with Shop Pay), but use <strong>Shop2 + Worldpay MCP</strong> for subscription orders.';
    } else if (market.worldpayMCP !== false) {
        return '<strong>Use Worldpay MCP</strong> as primary gateway. Shopify Payments not available in ' + market.name + ', but Worldpay MCP can be set up in 2-3 days with Unicity existing agreement.';
    } else {
        return '<strong>Shop2 + Worldpay MCP</strong> recommended. Local gateways (' + (market.localGateways ? market.localGateways.join(', ') : 'limited') + ') may require direct relationships.';
    }
}

function generateResultsHTML(code, market, orderValue, analysis) {
    var recBadge = analysis.recommended === 'shopify' ? 'badge-shopify' : analysis.recommended === 'worldpay' ? 'badge-worldpay' : 'badge-shop2';
    var recLabel = analysis.recommended === 'shopify' ? 'Shopify Payments' : analysis.recommended === 'worldpay' ? 'Worldpay MCP' : 'Shop2 + Worldpay';
    
    var html = '<div class="country-header"><span class="country-flag">' + market.flag + '</span>';
    html += '<div class="country-info"><h2>' + market.name + '</h2>';
    html += '<div class="currency">' + market.currency + ' â€¢ ' + market.region + '</div></div></div>';

    html += '<div class="status-grid">';
    html += '<div class="status-card"><div class="status-icon">' + (market.shopifyPayments ? 'âœ…' : 'âŒ') + '</div><div class="status-label">Shopify Payments</div><div class="status-value ' + (market.shopifyPayments ? 'yes' : 'no') + '">' + (market.shopifyPayments ? 'Available' : 'Not Available') + '</div></div>';
    html += '<div class="status-card"><div class="status-icon">' + (market.shopPay ? 'ğŸ›ï¸' : 'â–') + '</div><div class="status-label">Shop Pay</div><div class="status-value ' + (market.shopPay ? 'yes' : 'no') + '">' + (market.shopPay ? 'Available' : 'Not Available') + '</div></div>';
    html += '<div class="status-card"><div class="status-icon">' + (market.subscriptionsWork ? 'ğŸ”„' : 'âš ï¸') + '</div><div class="status-label">Subscriptions</div><div class="status-value ' + (market.subscriptionsWork ? 'yes' : 'partial') + '">' + (market.subscriptionsWork ? 'Supported' : 'Limited') + '</div></div>';
    html += '<div class="status-card"><div class="status-icon">' + (market.worldpayMCP !== false ? 'ğŸŒ' : 'â–') + '</div><div class="status-label">Worldpay MCP</div><div class="status-value ' + (market.worldpayMCP !== false ? 'yes' : 'partial') + '">' + (market.worldpayMCP !== false ? 'Available' : 'Limited') + '</div></div>';
    html += '<div class="status-card"><div class="status-icon">' + (market.unicityActive ? 'â­' : 'ğŸ†•') + '</div><div class="status-label">Unicity Status</div><div class="status-value ' + (market.unicityActive ? 'yes' : 'partial') + '">' + (market.unicityActive ? 'Active' : 'New Market') + '</div></div>';
    html += '</div>';

    html += '<div class="recommendation-panel"><h3><span class="recommendation-badge ' + recBadge + '">' + recLabel + '</span> Recommended Solution</h3>';
    html += '<p>' + getRecommendationText(market, analysis) + '</p>';
    html += '<div class="timeline-info">';
    var isShop2Rec = analysis.recommendedModel && analysis.recommendedModel.name === 'Shop2 + Worldpay MCP';
    if (isShop2Rec) {
        html += '<div class="timeline-item"><h5>Currency Setup</h5><div class="time">2-3 days</div></div>';
        html += '<div class="timeline-item"><h5>Development</h5><div class="time">4-6 weeks</div></div>';
    } else {
        html += '<div class="timeline-item"><h5>Setup Time</h5><div class="time">' + (analysis.recommendedModel ? analysis.recommendedModel.setupTime : '2-3 days') + '</div></div>';
    }
    html += '<div class="timeline-item"><h5>Processing Rate</h5><div class="time">' + formatPercent(analysis.recommendedModel ? analysis.recommendedModel.rate : WORLDPAY_MCP.totalRate) + '</div></div>';
    html += '<div class="timeline-item"><h5>Fees on $' + orderValue + '</h5><div class="time">' + formatCurrency(analysis.recommendedModel ? analysis.recommendedModel.fees : (orderValue * WORLDPAY_MCP.totalRate / 100)) + '</div></div>';
    html += '</div></div>';

    if (market.topMobilePayments && market.topMobilePayments.length > 0) {
        html += '<div class="mobile-payments-section" style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(0, 212, 170, 0.1) 100%); border: 1px solid var(--shop2-purple); border-radius: 12px; padding: 20px; margin-bottom: 30px;">';
        html += '<h3 style="font-size: 1.1rem; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">ğŸ“± Top Mobile Payment Methods in ' + market.name + '</h3>';
        html += '<div style="display: flex; gap: 15px; flex-wrap: wrap;">';
        market.topMobilePayments.forEach(function(method, index) {
            var rank = index === 0 ? 'ğŸ¥‡' : 'ğŸ¥ˆ';
            html += '<div style="background: var(--card-bg); border: 1px solid var(--border); border-radius: 10px; padding: 15px 20px; flex: 1; min-width: 150px; display: flex; align-items: center; gap: 10px;">';
            html += '<span style="font-size: 1.5rem;">' + rank + '</span>';
            html += '<div><div style="font-weight: 600; font-size: 1rem;">' + method + '</div>';
            html += '<div style="font-size: 0.75rem; color: var(--text-muted);">' + (index === 0 ? 'Most Popular' : 'Second Most Popular') + '</div></div></div>';
        });
        html += '</div>';
        html += '<p style="font-size: 0.8rem; color: var(--text-muted); margin-top: 12px;">ğŸ’¡ Consider supporting these methods to maximize local conversion rates</p>';
        html += '</div>';
    }

    html += generatePaymentMethodsHTML(market);

    html += '<div class="models-section"><h3>ğŸ“Š Available Payment Models</h3><div class="model-cards">';
    analysis.models.forEach(function(model) {
        var isRec = model === analysis.recommendedModel;
        html += '<div class="model-card ' + (isRec ? 'recommended' : '') + ' ' + (!model.available ? 'unavailable' : '') + '">';
        html += '<div class="model-header"><div><h4>' + model.name + '</h4><div class="model-type">' + model.type + '</div></div>';
        html += '<span class="model-available ' + (model.available ? 'yes' : 'no') + '">' + (model.available ? (isRec ? 'â˜… RECOMMENDED' : 'Available') : 'Unavailable') + '</span></div>';
        html += '<ul class="model-features">';
        html += '<li><span class="feature-icon">' + (model.features.shopPay ? 'âœ…' : 'âŒ') + '</span> Shop Pay Express</li>';
        html += '<li><span class="feature-icon">' + (model.features.subscriptions ? 'âœ…' : 'âŒ') + '</span> Subscriptions</li>';
        html += '<li><span class="feature-icon">' + (model.features.applePay ? 'âœ…' : 'âŒ') + '</span> Apple/Google Pay</li>';
        html += '<li><span class="feature-icon">' + (model.features.localMethods ? 'âœ…' : 'â–') + '</span> Local Methods</li>';
        html += '</ul>';
        if (model.available && model.rate) {
            html += '<div class="model-rate"><div class="rate-label">Effective Rate</div><div class="rate-value">' + formatPercent(model.rate) + '</div><div class="rate-breakdown">' + model.rateBreakdown + '</div></div>';
        }
        html += '</div>';
    });
    html += '</div></div>';

    html += '<div class="fee-table-section"><h3>ğŸ’° Fee Comparison for ' + formatCurrency(orderValue) + ' Order</h3>';
    html += '<div class="fee-table-wrapper"><table class="fee-table"><thead><tr><th>Solution</th><th>Rate</th><th>Processing Fee</th><th>Shopify Fee</th><th>Total</th><th>Net</th></tr></thead><tbody>';
    analysis.models.filter(function(m) { return m.available; }).forEach(function(model) {
        var shopifyFee = model.shopifyFee ? (orderValue * model.shopifyFee / 100) : 0;
        var totalFees = model.fees + shopifyFee;
        var net = orderValue - totalFees;
        var isRec = model === analysis.recommendedModel;
        html += '<tr class="' + (isRec ? 'highlight-row' : '') + '"><td><strong>' + model.name + '</strong><br><small>' + model.type + '</small></td>';
        html += '<td>' + formatPercent(model.rate) + '</td><td>' + formatCurrency(model.fees) + '</td>';
        html += '<td>' + (model.shopifyFee ? formatCurrency(shopifyFee) : '-') + '</td>';
        html += '<td class="total-cell">' + formatCurrency(totalFees) + '</td><td class="total-cell">' + formatCurrency(net) + '</td></tr>';
    });
    html += '</tbody></table></div></div>';

    html += '<div class="gateways-section"><h3>ğŸ”Œ Available Gateways</h3><div class="gateway-grid">';
    if (market.worldpayMCP !== false) {
        html += '<div class="gateway-card primary"><h5>Worldpay MCP <span class="gateway-type">Unicity Partner</span></h5><div class="gateway-rate">' + formatPercent(market.worldpayRate || WORLDPAY_MCP.totalRate) + '</div><div class="gateway-features">Global â€¢ Subscriptions âœ“ â€¢ 2-3 days</div></div>';
    }
    if (market.localGateways) {
        market.localGateways.forEach(function(gw) {
            html += '<div class="gateway-card"><h5>' + gw + ' <span class="gateway-type">Local</span></h5><div class="gateway-rate">' + (market.localRate ? formatPercent(market.localRate) : 'Varies') + '</div><div class="gateway-features">Local expertise</div></div>';
        });
    }
    html += '</div></div>';

    if (market.notes && market.notes.length > 0) {
        html += '<div class="notes-section"><h4>âš ï¸ Market Notes</h4><ul>';
        market.notes.forEach(function(note) { html += '<li>' + note + '</li>'; });
        html += '</ul></div>';
    }
    return html;
}

function initShopPayMarkets() {
    var container = document.getElementById('shopPayMarkets');
    var markets = Object.entries(MARKET_DATA).filter(function(e) { return e[1].shopPay === true; }).sort(function(a,b) { return a[1].name.localeCompare(b[1].name); });
    container.innerHTML = markets.map(function(e) { return '<div class="market-tag" onclick="selectCountry(\'' + e[0] + '\')">' + e[1].flag + ' ' + e[1].name + '</div>'; }).join('');
}

function initUnicityDropdown() {
    var container = document.getElementById('unicityDropdown');
    var markets = Object.entries(MARKET_DATA).filter(function(e) { return e[1].unicityActive === true; }).sort(function(a,b) { return a[1].name.localeCompare(b[1].name); });
    container.innerHTML = markets.map(function(e) { return '<div class="dropdown-item" onclick="selectCountry(\'' + e[0] + '\')"><span>' + e[1].flag + ' ' + e[1].name + '</span><span style="color:var(--accent);font-size:0.8rem;">' + e[1].currency + '</span></div>'; }).join('');
}

document.addEventListener('DOMContentLoaded', function() {
    initAutocomplete();
    initShopPayMarkets();
    initUnicityDropdown();
});
</script>
</body>
</html>
